var V=Object.defineProperty,ee=Object.defineProperties;var te=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var ue=Object.prototype.hasOwnProperty,ae=Object.prototype.propertyIsEnumerable;var K=(a,r,i)=>r in a?V(a,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[r]=i,H=(a,r)=>{for(var i in r||(r={}))ue.call(r,i)&&K(a,i,r[i]);if(M)for(var i of M(r))ae.call(r,i)&&K(a,i,r[i]);return a},P=(a,r)=>ee(a,te(r));import{u as q,a as U,r as n,v as se,b as v,j as d,c as e,A as re,T as ie,d as ne,e as le,F as G,B as oe,R as ce,f as j,g as de,h as he}from"./vendor.744e6562.js";const pe=function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const s of c)if(s.type==="childList")for(const m of s.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&o(m)}).observe(document,{childList:!0,subtree:!0});function i(c){const s={};return c.integrity&&(s.integrity=c.integrity),c.referrerpolicy&&(s.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?s.credentials="include":c.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(c){if(c.ep)return;c.ep=!0;const s=i(c);fetch(c.href,s)}};pe();const A="https://mazete-api-dev.pechakucha.ai",ge=ne({stringify:a=>a.kana+a.label});function me(){const[a,r]=n.exports.useState([0,0]);return n.exports.useLayoutEffect(()=>{function i(){r([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",i),i(),()=>window.removeEventListener("resize",i)},[]),a}function fe(){const a=q();U();const[r,i]=n.exports.useState(1),[o,c]=n.exports.useState([]),[s,m]=n.exports.useState(null),[w,L]=n.exports.useState(!1),[C,k]=n.exports.useState([]),[T,$]=n.exports.useState([]),[S,N]=n.exports.useState([]),[g,f]=n.exports.useState([]),[F,_]=n.exports.useState([]),[E,b]=n.exports.useState(null),[z,y]=me();n.exports.useEffect(()=>{let t=window.innerHeight;document.getElementById("character_select").style.height=t+"px";let u=se();var h=JSON.stringify({register_id:u}),l={method:"post",url:`${A}/register_id`,headers:{"Content-Type":"application/json"},data:h};v(l).then(p=>{localStorage.setItem("register_id",u)}).catch(p=>{a("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let D=JSON.stringify({user_id:u,search_query:"",chosen_chara_ids:"",chosen_world_ids:""}),I={method:"post",url:`${A}/get_chara_list`,headers:{"Content-Type":"application/json"},data:D};v(I).then(p=>{k(p.data.chara_list)}).catch(p=>{a("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let x=JSON.stringify({user_id:u,search_query:"",chosen_chara_ids:"",chosen_world_ids:""}),B={method:"post",url:`${A}/get_world_list`,headers:{"Content-Type":"application/json"},data:x};v(B).then(p=>{$(p.data.world_list)}).catch(p=>{a("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let Y={method:"post",url:`${A}/get_autocomplete_chara`,headers:{"Content-Type":"application/json"},data:{}};v(Y).then(p=>{f(p.data.auto_complete),_(p.data.auto_complete)}).catch(p=>{});let Z={method:"post",url:`${A}/get_autocomplete_world`,headers:{"Content-Type":"application/json"},data:{}};v(Z).then(p=>{N(p.data.auto_complete)}).catch(p=>{})},[]),n.exports.useEffect(()=>{s&&o.length>0&&L(!0)},[o,s]);const O=t=>{let u=o,h=C.filter(l=>l.chara_id==t)[0];if(u.map(l=>l.chara_id).includes(t)){for(let l=0;l<u.length;l++)u[l].chara_id===t&&(u.splice(l,1),l--);c([...u])}else u.length<3&&(u.push(h),c([...u]))},J=()=>{let t=localStorage.register_id||null,u=JSON.stringify({user_id:t,chosen_chara_ids:o.map(l=>l.chara_id).toString(),chosen_world_ids:[s.world_id].toString()}),h={method:"post",url:`${A}/generate_outline`,headers:{"Content-Type":"application/json"},data:u};v(h).then(l=>{localStorage.setItem("outline_id",l.data.outline_id),localStorage.setItem("background",s.img_url),localStorage.setItem("user_list",JSON.stringify(o.map(D=>D.img_url))),window.location.assign("/synopsis")}).catch(l=>{a("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},R=t=>{t.preventDefault();let u=localStorage.register_id||null,h=E,l=o.map(x=>x.chara_id).toString(),D="";s&&(D=[s.world_id].toString());let I=JSON.stringify({user_id:u,search_query:h,chosen_chara_ids:l,chosen_world_ids:D});if(r==1){let x={method:"post",url:`${A}/get_chara_list`,headers:{"Content-Type":"application/json"},data:I};v(x).then(B=>{k(B.data.chara_list)}).catch(B=>{a("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}else{let x={method:"post",url:`${A}/get_world_list`,headers:{"Content-Type":"application/json"},data:I};v(x).then(B=>{$(B.data.world_list)}).catch(B=>{a("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}},W=t=>u=>{u.stopPropagation();let h=o;for(let l=0;l<h.length;l++)h[l].chara_id===t&&(h.splice(l,1),l--);c([...h])};return d("div",{className:"container",id:"character_select",children:[d("div",{className:"container-wrap",children:[d("div",{className:"common-header",children:[e("div",{className:"common-header-title01",children:"-\u4F5C\u54C1\u30EA\u30DF\u30C3\u30AF\u30B9-"}),e("div",{className:"common-header-title02",children:"\u30DE\u305C\u3066"})]}),d("div",{className:"preview",children:[d("div",{className:"preview-part",onClick:()=>{i(1),_(g),b(null)},children:[d("div",{className:"preview-img-part",children:[o.map(t=>e("div",{style:{backgroundImage:`url(${t.img_url})`},className:"avatar-preview",children:d("div",{className:"avatar-preview-close",onClick:W(t.chara_id),children:[e("span",{}),e("span",{})]})},t.chara_id)),o.length==0&&e("div",{className:"avatar-preview",style:{backgroundImage:"url(/assets/image/default-avatar.png)"}})]}),e("div",{className:r===1?"preview-title-part active":"preview-title-part",children:"\u30AD\u30E3\u30E9"})]}),d("div",{className:"preview-part",onClick:()=>{i(2),_(S),b(null)},children:[e("div",{className:"preview-img-part",children:e("div",{style:{backgroundImage:`url(${s!=null?s.img_url:"/assets/image/point-bg.png"})`},className:s!=null?"world-preview":"world-none-preview"})}),e("div",{className:r===2?"preview-title-part active":"preview-title-part",children:"\u30B7\u30C1\u30E5\u30A8\u30FC\u30B7\u30E7\u30F3"})]})]}),d("div",{className:"point-select",children:[e("div",{className:"point-search",children:d("form",{onSubmit:R,children:[e(re,{value:E,onChange:(t,u)=>{typeof u=="string"?b({label:u}):u&&u.inputValue?b({label:u.inputValue}):b(u)},filterOptions:(t,u)=>ge(t,u),selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:F,getOptionLabel:t=>typeof t=="string"?t:t.label,renderOption:(t,u)=>e("li",P(H({},t),{children:u.label})),renderInput:t=>e(ie,P(H({},t),{label:""}))}),e("button",{className:"search-btn",children:e("img",{src:"/assets/image/point-search.png",alt:""})})]})}),e("div",{className:"point-intro",children:"\u753B\u50CF\u306FBing\u306E\u691C\u7D22\u7D50\u679C\u3092\u3082\u3068\u306B\u8868\u793A\u3057\u3066\u3044\u307E\u3059"}),d("div",{className:"point-body",style:{height:`calc(${y}px - 420px)`},children:[r===1&&e("div",{className:"point-body-wrap",children:C.map((t,u)=>e("div",{style:{backgroundImage:`url(${t.img_url})`},onClick:()=>O(t.chara_id),className:`${o.map(h=>h.chara_id).includes(t.chara_id)?"active":""} character-item`,children:e("span",{})},u))}),r==2&&e("div",{className:"point-body-wrap",children:T.map((t,u)=>e("div",{style:{backgroundImage:`url(${t.img_url})`},className:`${(s==null?void 0:s.img_url)==t.img_url?"active":""} location-item`,onClick:h=>{m(t)},children:e("span",{})},u))})]})]})]}),e("div",{className:"character-add-btn-part",children:e("button",{onClick:J,className:`character-add-btn ${w?"active":""}`,disabled:!w,children:"\u30DE\u305C\u308B"})})]})}const Q="https://mazete-api-dev.pechakucha.ai";function _e(){const[a,r]=n.exports.useState([0,0]);return n.exports.useLayoutEffect(()=>{function i(){r([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",i),i(),()=>window.removeEventListener("resize",i)},[]),a}function ve(){const a=q(),r=n.exports.useRef(),[i,o]=n.exports.useState(!1),[c,s]=n.exports.useState(!0),[m,w]=n.exports.useState(`\u30D3\u30EB\u306E\u5C4B\u4E0A\u306B\u3042\u3064\u3081\u3089\u308C\u305F\u30B4\u30F3\u9054\u3002

\u5229\u6839\u5DDD\u304B\u3089\u9244\u9AA8\u306E\u4E0A\u3092\u6E21\u3063\u3066\u3001\u5411\u3053\u3046\u306E\u30D3\u30EB\u3078\u884C\u3051\u305F\u3082\u306E\u306B\u8CDE\u91D1\u304C\u3082\u3089\u3048\u308B\u3068\u8AAC\u660E\u3092\u53D7\u3051\u308B\u3002

\u30B4\u30F3\u9054\u306F\u3044\u304B\u306B\u3057\u3066\u3053\u306E\u5371\u6A5F\u3092\u4E57\u308A\u8D8A\u3048\u308B\u306E\u304B\uFF1F`),[L,C]=n.exports.useState([]),[k,T]=n.exports.useState(null),[$,S]=_e();n.exports.useEffect(()=>{let g=window.innerHeight;document.getElementById("loading_synposis").style.height=g+"px";let f=localStorage.register_id||null,F=localStorage.outline_id||null,_=localStorage.background||null,E=localStorage.user_list||null;(!E||!_)&&a("/",{state:{}}),T(_),C(JSON.parse(E));let b=JSON.stringify({user_id:f,outline_id:F}),z={method:"post",url:`${Q}/get_outline`,headers:{"Content-Type":"application/json"},data:b};v(z).then(y=>{y.data.generated&&y.data.outline&&!y.data.error?(s(!1),w(y.data.outline)):a("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(y=>{a("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},[]);const N=()=>{let g=localStorage.register_id||null,f=localStorage.outline_id||null,F=JSON.stringify({user_id:g,outline_id:f,outline:m}),_={method:"post",url:`${Q}/generate_story`,headers:{"Content-Type":"application/json"},data:F};v(_).then(E=>{window.location.assign(`/talk/${E.data.story_id}`)}).catch(E=>{a("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})};return n.exports.useEffect(()=>{r.current&&i&&r.current.focus()},[i]),d("div",{className:"container",id:"loading_synposis",children:[d("div",{className:"container-wrap",children:[e("div",{className:`ls-top ${i?"editing":""}`,children:e("div",{className:"",style:{backgroundImage:`url(${k}`,backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"},children:e("div",{className:"ls-top-body",children:L.map((g,f)=>e("div",{className:"ls-top-item",style:{backgroundImage:`url(${g})`}},f))})})}),d("div",{className:"ls-main",style:{height:`calc(${S}px - 280px)`},children:[e("div",{className:"ls-main-title",children:"\u307E\u3048\u304C\u304D"}),d("div",{className:"ls-main-loading-text",style:{height:"calc(100% - 70px)"},children:[c&&d("div",{className:"ls-main-loading-part",children:[e("img",{src:"/assets/image/white-loading.gif",alt:""}),e("span",{children:"\u4E0B\u66F8\u304D\u6E96\u5099\u4E2D"})]}),!c&&e("textarea",{ref:r,className:"ls-main-loading-wrap",value:m,disabled:!i,onChange:g=>{w(g.target.value)},onBlur:()=>{o(!1)}})]}),!i&&d("a",{className:"ls-main-edit-btn",onClick:()=>{r.current.focus(),o(!0)},children:[e("span",{children:"\u7DE8\u96C6"}),e("img",{src:"/assets/image/edit-icon.png",alt:""})]})]})]}),!i&&e("button",{className:"back-to-btn",onClick:()=>{let g=localStorage.user_list||null;a("/",{state:{user_list:g}})},children:e("img",{src:"/assets/image/back-to-img.png",alt:""})}),!i&&e("div",{className:"ls-main-making-btn-part",children:e("button",{onClick:N,className:c?"ls-main-making-btn":"ls-main-making-btn active",disabled:c,children:"\u3053\u306E\u4E16\u754C\u7DDA\u306B\u5165\u308B"})})]})}const Ee="https://mazete-api-dev.pechakucha.ai";function X(a){return new Promise(r=>setTimeout(r,a))}function be(){const[a,r]=n.exports.useState([0,0]);return n.exports.useLayoutEffect(()=>{function i(){r([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",i),i(),()=>window.removeEventListener("resize",i)},[]),a}function ye(){const a=q(),[r,i]=n.exports.useState(!0),[o,c]=n.exports.useState(null),[s,m]=n.exports.useState(0),[w,L]=n.exports.useState(null),[C,k]=n.exports.useState(null),[T,$]=n.exports.useState([]),[S,N]=n.exports.useState(!1),[g,f]=n.exports.useState(!1),[F,_]=n.exports.useState(!1),[E,b]=be();let{story_id:z}=le();n.exports.useEffect(()=>{let t=localStorage.register_id||null,u=JSON.stringify({user_id:t,story_id:z}),h={method:"post",url:`${Ee}/get_story`,headers:{"Content-Type":"application/json"},data:u};v(h).then(l=>{i(!1),l.data.generated&&!l.data.error?(i(!1),c(l.data)):a("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(l=>{a("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},[]),n.exports.useEffect(()=>{o&&y()},[o,s]),n.exports.useEffect(async()=>{if(o){let t=o.story;await X(1),L(t[s].position)}},[C]);const y=()=>{let t=o.story;k(t[s].chara_img_url),t[s].multiple?(N(!0),$(t[s].content)):(N(!1),O(t[s].content))},O=async t=>{_(!0);for(var u=0;u<t.length;)$([t.substring(0,u+1)]),u++,await X(75);_(!1),o.story.length-1==s&&f(!0)},J=t=>{S&&(N(!1),O(t))},R=()=>{!F&&!S&&o.story.length-1>s&&m(s+1)},W=()=>{console.log(),s===0&&a("/synopsis",{state:{}}),s!=0&&!F&&(m(s-1),f(!1))};return d(G,{children:[r&&e("div",{className:"container",id:"loading_adventure",children:e("div",{className:"container-wrap",children:d("div",{className:"la-wrap",children:[e("img",{src:"/assets/image/black-loading.gif",alt:""}),e("span",{children:"\u6E96\u5099\u4E2D"})]})})}),!r&&d("div",{className:"container",id:"adventure_state",style:{height:b},children:[d("div",{className:"container-wrap",onClick:R,children:[e("div",{className:"as-thumb",style:{backgroundImage:`url(${o==null?void 0:o.background_url})`},children:C&&e("img",{src:C,alt:"",className:`as-thumb-character ${w==0?"lb":w==1?"mb":"rb"}`})}),e("div",{className:"as-text",children:T.map((t,u)=>e("div",{className:`as-text-wrap ${S?"":"arrow"}`,onClick:()=>{J(t)},children:t},u))})]}),e("button",{className:"back-to-btn",onClick:W,children:e("img",{src:s==0?"/assets/image/back-to-img.png":"/assets/image/back.png",alt:""})}),g&&d("div",{className:"text-select-btn-group",children:[e("a",{onClick:()=>{m(0),f(!1)},className:"final-btn",children:"\u30C8\u30C3\u30D7\u3078"}),e("a",{className:"final-btn",children:"\u30B7\u30A7\u30A2"})]})]})]})}function we(){const a=U();return console.log(a),e("div",{className:"flex-center position-ref full-height full-width bg-white",children:e("div",{className:"message",style:{padding:"10px"},dangerouslySetInnerHTML:{__html:a.state.message}})})}function Ce(){return e(oe,{children:d(ce,{children:[e(j,{path:"/",element:e(fe,{})}),e(j,{path:"/synopsis",element:e(ve,{})}),e(j,{path:"/talk/:id",element:e(ye,{})}),e(j,{path:"/error",element:e(we,{})})]})})}function Fe(){return e(G,{children:e(Ce,{})})}de.render(e(he.StrictMode,{children:e(Fe,{})}),document.getElementById("root"));
