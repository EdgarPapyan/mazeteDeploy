var ee=Object.defineProperty,te=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var K=(u,a,s)=>a in u?ee(u,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):u[a]=s,H=(u,a)=>{for(var s in a||(a={}))ae.call(a,s)&&K(u,s,a[s]);if(M)for(var s of M(a))se.call(a,s)&&K(u,s,a[s]);return u},P=(u,a)=>te(u,ue(a));import{u as q,a as U,r as i,v as re,b as E,j as d,c as e,A as ie,T as ne,d as le,e as oe,R as G,F as Q,B as ce,f as de,g as R,h as he}from"./vendor.b316abc2.js";const pe=function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))o(c);new MutationObserver(c=>{for(const r of c)if(r.type==="childList")for(const y of r.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&o(y)}).observe(document,{childList:!0,subtree:!0});function s(c){const r={};return c.integrity&&(r.integrity=c.integrity),c.referrerpolicy&&(r.referrerPolicy=c.referrerpolicy),c.crossorigin==="use-credentials"?r.credentials="include":c.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(c){if(c.ep)return;c.ep=!0;const r=s(c);fetch(c.href,r)}};pe();const N="https://mazete-api-dev.pechakucha.ai",ge=le({stringify:u=>u.kana+u.label});function me(){const[u,a]=i.exports.useState([0,0]);return i.exports.useLayoutEffect(()=>{function s(){a([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",s),s(),()=>window.removeEventListener("resize",s)},[]),u}function fe(){const u=q();U();const[a,s]=i.exports.useState(1),[o,c]=i.exports.useState([]),[r,y]=i.exports.useState(null),[F,T]=i.exports.useState(!1),[A,$]=i.exports.useState([]),[z,D]=i.exports.useState([]),[x,B]=i.exports.useState([]),[m,_]=i.exports.useState([]),[S,v]=i.exports.useState([]),[b,C]=i.exports.useState(null),[I,w]=me();i.exports.useEffect(()=>{let n=window.innerHeight;document.getElementById("character_select").style.height=n+"px";let l=re();var h=JSON.stringify({register_id:l}),t={method:"post",url:`${N}/register_id`,headers:{"Content-Type":"application/json"},data:h};E(t).then(g=>{localStorage.setItem("register_id",l)}).catch(g=>{u("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let p=JSON.stringify({user_id:l,search_query:"",chosen_chara_ids:"",chosen_world_ids:""}),L={method:"post",url:`${N}/get_chara_list`,headers:{"Content-Type":"application/json"},data:p};E(L).then(g=>{$(g.data.chara_list)}).catch(g=>{u("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let f=JSON.stringify({user_id:l,search_query:"",chosen_chara_ids:"",chosen_world_ids:""}),k={method:"post",url:`${N}/get_world_list`,headers:{"Content-Type":"application/json"},data:f};E(k).then(g=>{D(g.data.world_list)}).catch(g=>{u("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let Z={method:"post",url:`${N}/get_autocomplete_chara`,headers:{"Content-Type":"application/json"},data:{}};E(Z).then(g=>{_(g.data.auto_complete),v(g.data.auto_complete)}).catch(g=>{});let V={method:"post",url:`${N}/get_autocomplete_world`,headers:{"Content-Type":"application/json"},data:{}};E(V).then(g=>{B(g.data.auto_complete)}).catch(g=>{})},[]),i.exports.useEffect(()=>{r&&o.length>0&&T(!0)},[o,r]);const O=n=>{let l=o,h=A.filter(t=>t.chara_id==n)[0];if(l.map(t=>t.chara_id).includes(n)){for(let t=0;t<l.length;t++)l[t].chara_id===n&&(l.splice(t,1),t--);c([...l])}else l.length<3&&(l.push(h),c([...l]))},J=()=>{let n=localStorage.register_id||null,l=JSON.stringify({user_id:n,chosen_chara_ids:o.map(t=>t.chara_id).toString(),chosen_world_ids:[r.world_id].toString()}),h={method:"post",url:`${N}/generate_outline`,headers:{"Content-Type":"application/json"},data:l};E(h).then(t=>{localStorage.setItem("outline_id",t.data.outline_id),localStorage.setItem("background",r.img_url),localStorage.setItem("user_list",JSON.stringify(o.map(p=>p.img_url))),window.location.assign("/synopsis")}).catch(t=>{u("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},W=n=>{n.preventDefault();let l=localStorage.register_id||null,h=b,t=o.map(f=>f.chara_id).toString(),p="";r&&(p=[r.world_id].toString());let L=JSON.stringify({user_id:l,search_query:h,chosen_chara_ids:t,chosen_world_ids:p});if(a==1){let f={method:"post",url:`${N}/get_chara_list`,headers:{"Content-Type":"application/json"},data:L};E(f).then(k=>{$(k.data.chara_list)}).catch(k=>{u("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}else{let f={method:"post",url:`${N}/get_world_list`,headers:{"Content-Type":"application/json"},data:L};E(f).then(k=>{D(k.data.world_list)}).catch(k=>{u("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}},j=n=>l=>{l.stopPropagation();let h=o;for(let t=0;t<h.length;t++)h[t].chara_id===n&&(h.splice(t,1),t--);c([...h])};return d("div",{className:"container",id:"character_select",children:[d("div",{className:"container-wrap",children:[d("div",{className:"common-header",children:[e("div",{className:"common-header-title01",children:"-\u4F5C\u54C1\u30EA\u30DF\u30C3\u30AF\u30B9-"}),e("div",{className:"common-header-title02",children:"\u30DE\u305C\u3066"})]}),d("div",{className:"preview",children:[d("div",{className:"preview-part",onClick:()=>{s(1),v(m),C(null)},children:[d("div",{className:"preview-img-part",children:[o.map(n=>e("div",{style:{backgroundImage:`url(${n.img_url})`},className:"avatar-preview",children:d("div",{className:"avatar-preview-close",onClick:j(n.chara_id),children:[e("span",{}),e("span",{})]})},n.chara_id)),o.length==0&&e("div",{className:"avatar-preview",style:{backgroundImage:"url(/assets/image/default-avatar.png)"}})]}),e("div",{className:a===1?"preview-title-part active":"preview-title-part",children:"\u30AD\u30E3\u30E9"})]}),d("div",{className:"preview-part",onClick:()=>{s(2),v(x),C(null)},children:[e("div",{className:"preview-img-part",children:e("div",{style:{backgroundImage:`url(${r!=null?r.img_url:"/assets/image/point-bg.png"})`},className:r!=null?"world-preview":"world-none-preview"})}),e("div",{className:a===2?"preview-title-part active":"preview-title-part",children:"\u30B7\u30C1\u30E5\u30A8\u30FC\u30B7\u30E7\u30F3"})]})]}),d("div",{className:"point-select",children:[e("div",{className:"point-search",children:d("form",{onSubmit:W,children:[e(ie,{value:b,onChange:(n,l)=>{typeof l=="string"?C({label:l}):l&&l.inputValue?C({label:l.inputValue}):C(l)},filterOptions:(n,l)=>ge(n,l),selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:S,getOptionLabel:n=>typeof n=="string"?n:n.label,renderOption:(n,l)=>e("li",P(H({},n),{children:l.label})),renderInput:n=>e(ne,P(H({},n),{label:""}))}),e("button",{className:"search-btn",children:e("img",{src:"/assets/image/point-search.png",alt:""})})]})}),e("div",{className:"point-intro",children:"\u753B\u50CF\u306FBing\u306E\u691C\u7D22\u7D50\u679C\u3092\u3082\u3068\u306B\u8868\u793A\u3057\u3066\u3044\u307E\u3059"}),d("div",{className:"point-body",style:{height:`calc(${w}px - 420px)`},children:[a===1&&e("div",{className:"point-body-wrap",children:A.map((n,l)=>e("div",{style:{backgroundImage:`url(${n.img_url})`},onClick:()=>O(n.chara_id),className:`${o.map(h=>h.chara_id).includes(n.chara_id)?"active":""} character-item`,children:e("span",{})},l))}),a==2&&e("div",{className:"point-body-wrap",children:z.map((n,l)=>e("div",{style:{backgroundImage:`url(${n.img_url})`},className:`${(r==null?void 0:r.img_url)==n.img_url?"active":""} location-item`,onClick:h=>{y(n)},children:e("span",{})},l))})]})]})]}),e("div",{className:"character-add-btn-part",children:e("button",{onClick:J,className:`character-add-btn ${F?"active":""}`,disabled:!F,children:"\u30DE\u305C\u308B"})})]})}const X="https://mazete-api-dev.pechakucha.ai";function _e(){const[u,a]=i.exports.useState([0,0]);return i.exports.useLayoutEffect(()=>{function s(){a([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",s),s(),()=>window.removeEventListener("resize",s)},[]),u}function ve(){const u=q(),a=i.exports.useRef(),[s,o]=i.exports.useState(!1),[c,r]=i.exports.useState(!0),[y,F]=i.exports.useState(`\u30D3\u30EB\u306E\u5C4B\u4E0A\u306B\u3042\u3064\u3081\u3089\u308C\u305F\u30B4\u30F3\u9054\u3002

\u5229\u6839\u5DDD\u304B\u3089\u9244\u9AA8\u306E\u4E0A\u3092\u6E21\u3063\u3066\u3001\u5411\u3053\u3046\u306E\u30D3\u30EB\u3078\u884C\u3051\u305F\u3082\u306E\u306B\u8CDE\u91D1\u304C\u3082\u3089\u3048\u308B\u3068\u8AAC\u660E\u3092\u53D7\u3051\u308B\u3002

\u30B4\u30F3\u9054\u306F\u3044\u304B\u306B\u3057\u3066\u3053\u306E\u5371\u6A5F\u3092\u4E57\u308A\u8D8A\u3048\u308B\u306E\u304B\uFF1F`),[T,A]=i.exports.useState([]),[$,z]=i.exports.useState(null),[D,x]=_e();i.exports.useEffect(()=>{let m=window.innerHeight;document.getElementById("loading_synposis").style.height=m+"px";let _=localStorage.register_id||null,S=localStorage.outline_id||null,v=localStorage.background||null,b=localStorage.user_list||null;(!b||!v)&&u("/",{state:{}}),z(v),A(JSON.parse(b));let C=JSON.stringify({user_id:_,outline_id:S}),I={method:"post",url:`${X}/get_outline`,headers:{"Content-Type":"application/json"},data:C};E(I).then(w=>{w.data.generated&&w.data.outline&&!w.data.error?(r(!1),F(w.data.outline)):u("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(w=>{u("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},[]);const B=()=>{let m=localStorage.register_id||null,_=localStorage.outline_id||null,S=JSON.stringify({user_id:m,outline_id:_,outline:y}),v={method:"post",url:`${X}/generate_story`,headers:{"Content-Type":"application/json"},data:S};E(v).then(b=>{window.location.assign(`/talk/${b.data.story_id}`)}).catch(b=>{u("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})};return i.exports.useEffect(()=>{a.current&&s&&a.current.focus()},[s]),d("div",{className:"container",id:"loading_synposis",children:[d("div",{className:"container-wrap",children:[e("div",{className:`ls-top ${s?"editing":""}`,children:e("div",{className:"",style:{backgroundImage:`url(${$}`,backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"},children:e("div",{className:"ls-top-body",children:T.map((m,_)=>e("div",{className:"ls-top-item",style:{backgroundImage:`url(${m})`}},_))})})}),d("div",{className:"ls-main",style:{height:`calc(${x}px - 280px)`},children:[e("div",{className:"ls-main-title",children:"\u307E\u3048\u304C\u304D"}),d("div",{className:"ls-main-loading-text",style:{height:"calc(100% - 70px)"},children:[c&&d("div",{className:"ls-main-loading-part",children:[e("img",{src:"/assets/image/white-loading.gif",alt:""}),e("span",{children:"\u4E0B\u66F8\u304D\u6E96\u5099\u4E2D"})]}),!c&&e("textarea",{ref:a,className:"ls-main-loading-wrap",value:y,disabled:!s,onChange:m=>{F(m.target.value)},onBlur:()=>{o(!1)}})]}),!s&&d("a",{className:"ls-main-edit-btn",onClick:()=>{a.current.focus(),o(!0)},children:[e("span",{children:"\u7DE8\u96C6"}),e("img",{src:"/assets/image/edit-icon.png",alt:""})]})]})]}),!s&&e("button",{className:"back-to-btn",onClick:()=>{let m=localStorage.user_list||null;u("/",{state:{user_list:m}})},children:e("img",{src:"/assets/image/back-to-img.png",alt:""})}),!s&&e("div",{className:"ls-main-making-btn-part",children:e("button",{onClick:B,className:c?"ls-main-making-btn":"ls-main-making-btn active",disabled:c,children:"\u3053\u306E\u4E16\u754C\u7DDA\u306B\u5165\u308B"})})]})}const we="https://mazete-api-dev.pechakucha.ai";function Y(u){return new Promise(a=>setTimeout(a,u))}function Ee(){const[u,a]=i.exports.useState([0,0]);return i.exports.useLayoutEffect(()=>{function s(){a([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",s),s(),()=>window.removeEventListener("resize",s)},[]),u}function ye(){const u=q(),[a,s]=i.exports.useState(!0),[o,c]=i.exports.useState(null),[r,y]=i.exports.useState(0),[F,T]=i.exports.useState(null),[A,$]=i.exports.useState(null),[z,D]=i.exports.useState([]),[x,B]=i.exports.useState(!1),[m,_]=i.exports.useState(!1),[S,v]=i.exports.useState(!1),[b,C]=Ee();let{story_id:I}=oe();const w=G.useRef(r),O=t=>{w.current=t,y(t)};i.exports.useEffect(()=>{let t=localStorage.register_id||null,p=JSON.stringify({user_id:t,story_id:I}),L={method:"post",url:`${we}/get_story`,headers:{"Content-Type":"application/json"},data:p};E(L).then(f=>{s(!1),f.data.generated&&!f.data.error?(s(!1),c(f.data)):u("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(f=>{u("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}),window.history.pushState(null,null,window.location.pathname),window.addEventListener("popstate",J)},[]);const J=t=>{t.preventDefault(),window.history.pushState(null,null,window.location.pathname),h()};i.exports.useEffect(()=>{o&&W()},[o,r]),i.exports.useEffect(async()=>{if(o){let t=o.story;await Y(1),T(t[r].position)}},[A]);const W=()=>{let t=o.story;$(t[r].chara_img_url),t[r].multiple?(B(!0),D(t[r].content)):(B(!1),j(t[r].content))},j=async t=>{v(!0);for(var p=0;p<t.length;)D([t.substring(0,p+1)]),p++,await Y(75);v(!1),o.story.length-1==r&&_(!0)},n=t=>{x&&(B(!1),j(t))},l=()=>{!S&&!x&&o.story.length-1>r&&O(r+1)},h=()=>{w.current===0&&u("/synopsis",{state:{}}),w.current!=0&&!S&&(O(0),_(!1))};return d(Q,{children:[a&&e("div",{className:"container",id:"loading_adventure",children:e("div",{className:"container-wrap",children:d("div",{className:"la-wrap",children:[e("img",{src:"/assets/image/black-loading.gif",alt:""}),e("span",{children:"\u6E96\u5099\u4E2D"})]})})}),!a&&d("div",{className:"container",id:"adventure_state",style:{height:C},children:[d("div",{className:"container-wrap",onClick:l,children:[e("div",{className:"as-thumb",style:{backgroundImage:`url(${o==null?void 0:o.background_url})`},children:A&&e("img",{src:A,alt:"",className:`as-thumb-character ${F==0?"lb":F==1?"mb":"rb"}`})}),e("div",{className:"as-text",children:z.map((t,p)=>e("div",{className:`as-text-wrap ${x?"":"arrow"}`,onClick:()=>{n(t)},children:t},p))})]}),e("button",{className:"back-to-btn",onClick:h,children:e("img",{src:r==0?"/assets/image/back-to-img.png":"/assets/image/back.png",alt:""})}),m&&d("div",{className:"text-select-btn-group",children:[e("a",{onClick:()=>{O(0),_(!1)},className:"final-btn",children:"\u30C8\u30C3\u30D7\u3078"}),e("a",{className:"final-btn",children:"\u30B7\u30A7\u30A2"})]})]})]})}function be(){const u=U();return console.log(u),e("div",{className:"flex-center position-ref full-height full-width bg-white",children:e("div",{className:"message",style:{padding:"10px"},dangerouslySetInnerHTML:{__html:u.state.message}})})}function Ce(){return e(ce,{children:d(de,{children:[e(R,{path:"/",element:e(fe,{})}),e(R,{path:"/synopsis",element:e(ve,{})}),e(R,{path:"/talk/:id",element:e(ye,{})}),e(R,{path:"/error",element:e(be,{})})]})})}function Fe(){return e(Q,{children:e(Ce,{})})}he.render(e(G.StrictMode,{children:e(Fe,{})}),document.getElementById("root"));
