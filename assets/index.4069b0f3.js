var ee=Object.defineProperty,te=Object.defineProperties;var ue=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var ae=Object.prototype.hasOwnProperty,se=Object.prototype.propertyIsEnumerable;var K=(t,u,a)=>u in t?ee(t,u,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[u]=a,H=(t,u)=>{for(var a in u||(u={}))ae.call(u,a)&&K(t,a,u[a]);if(M)for(var a of M(u))se.call(u,a)&&K(t,a,u[a]);return t},P=(t,u)=>te(t,ue(u));import{u as q,a as U,r,v as re,b as v,j as h,c as e,A as ie,T as ne,d as le,e as oe,R as G,F as Q,B as ce,f as de,g as R,h as he}from"./vendor.b316abc2.js";const pe=function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const d of document.querySelectorAll('link[rel="modulepreload"]'))c(d);new MutationObserver(d=>{for(const s of d)if(s.type==="childList")for(const E of s.addedNodes)E.tagName==="LINK"&&E.rel==="modulepreload"&&c(E)}).observe(document,{childList:!0,subtree:!0});function a(d){const s={};return d.integrity&&(s.integrity=d.integrity),d.referrerpolicy&&(s.referrerPolicy=d.referrerpolicy),d.crossorigin==="use-credentials"?s.credentials="include":d.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function c(d){if(d.ep)return;d.ep=!0;const s=a(d);fetch(d.href,s)}};pe();const N="https://mazete-api-dev.pechakucha.ai",ge=le({stringify:t=>t.kana+t.label});function me(){const[t,u]=r.exports.useState([0,0]);return r.exports.useLayoutEffect(()=>{function a(){u([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",a),a(),()=>window.removeEventListener("resize",a)},[]),t}function fe(){const t=q();U();const[u,a]=r.exports.useState(1),[c,d]=r.exports.useState([]),[s,E]=r.exports.useState(null),[C,T]=r.exports.useState(!1),[F,D]=r.exports.useState([]),[z,L]=r.exports.useState([]),[x,B]=r.exports.useState([]),[g,m]=r.exports.useState([]),[A,f]=r.exports.useState([]),[b,y]=r.exports.useState(null),[I,_]=me();r.exports.useEffect(()=>{let i=window.innerHeight;document.getElementById("character_select").style.height=i+"px";let n=re();var l=JSON.stringify({register_id:n}),o={method:"post",url:`${N}/register_id`,headers:{"Content-Type":"application/json"},data:l};v(o).then(p=>{localStorage.setItem("register_id",n)}).catch(p=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let S=JSON.stringify({user_id:n,search_query:"",chosen_chara_ids:"",chosen_world_ids:""}),w={method:"post",url:`${N}/get_chara_list`,headers:{"Content-Type":"application/json"},data:S};v(w).then(p=>{D(p.data.chara_list)}).catch(p=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let k=JSON.stringify({user_id:n,search_query:"",chosen_chara_ids:"",chosen_world_ids:""}),$={method:"post",url:`${N}/get_world_list`,headers:{"Content-Type":"application/json"},data:k};v($).then(p=>{L(p.data.world_list)}).catch(p=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})});let Z={method:"post",url:`${N}/get_autocomplete_chara`,headers:{"Content-Type":"application/json"},data:{}};v(Z).then(p=>{m(p.data.auto_complete),f(p.data.auto_complete)}).catch(p=>{});let V={method:"post",url:`${N}/get_autocomplete_world`,headers:{"Content-Type":"application/json"},data:{}};v(V).then(p=>{B(p.data.auto_complete)}).catch(p=>{})},[]),r.exports.useEffect(()=>{s&&c.length>0&&T(!0)},[c,s]);const O=i=>{let n=c,l=F.filter(o=>o.chara_id==i)[0];if(n.map(o=>o.chara_id).includes(i)){for(let o=0;o<n.length;o++)n[o].chara_id===i&&(n.splice(o,1),o--);d([...n])}else n.length<3&&(n.push(l),d([...n]))},J=()=>{let i=localStorage.register_id||null,n=JSON.stringify({user_id:i,chosen_chara_ids:c.map(o=>o.chara_id).toString(),chosen_world_ids:[s.world_id].toString()}),l={method:"post",url:`${N}/generate_outline`,headers:{"Content-Type":"application/json"},data:n};v(l).then(o=>{localStorage.setItem("outline_id",o.data.outline_id),localStorage.setItem("background",s.img_url),localStorage.setItem("user_list",JSON.stringify(c.map(S=>S.img_url))),window.location.assign("/synopsis")}).catch(o=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},j=i=>{i.preventDefault();let n=localStorage.register_id||null,l=b,o=c.map(k=>k.chara_id).toString(),S="";s&&(S=[s.world_id].toString());let w=JSON.stringify({user_id:n,search_query:l,chosen_chara_ids:o,chosen_world_ids:S});if(u==1){let k={method:"post",url:`${N}/get_chara_list`,headers:{"Content-Type":"application/json"},data:w};v(k).then($=>{D($.data.chara_list)}).catch($=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}else{let k={method:"post",url:`${N}/get_world_list`,headers:{"Content-Type":"application/json"},data:w};v(k).then($=>{L($.data.world_list)}).catch($=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})}},W=i=>n=>{n.stopPropagation();let l=c;for(let o=0;o<l.length;o++)l[o].chara_id===i&&(l.splice(o,1),o--);d([...l])};return h("div",{className:"container",id:"character_select",children:[h("div",{className:"container-wrap",children:[h("div",{className:"common-header",children:[e("div",{className:"common-header-title01",children:"-\u4F5C\u54C1\u30EA\u30DF\u30C3\u30AF\u30B9-"}),e("div",{className:"common-header-title02",children:"\u30DE\u305C\u3066"})]}),h("div",{className:"preview",children:[h("div",{className:"preview-part",onClick:()=>{a(1),f(g),y(null)},children:[h("div",{className:"preview-img-part",children:[c.map(i=>e("div",{style:{backgroundImage:`url(${i.img_url})`},className:"avatar-preview",children:h("div",{className:"avatar-preview-close",onClick:W(i.chara_id),children:[e("span",{}),e("span",{})]})},i.chara_id)),c.length==0&&e("div",{className:"avatar-preview",style:{backgroundImage:"url(/assets/image/default-avatar.png)"}})]}),e("div",{className:u===1?"preview-title-part active":"preview-title-part",children:"\u30AD\u30E3\u30E9"})]}),h("div",{className:"preview-part",onClick:()=>{a(2),f(x),y(null)},children:[e("div",{className:"preview-img-part",children:e("div",{style:{backgroundImage:`url(${s!=null?s.img_url:"/assets/image/point-bg.png"})`},className:s!=null?"world-preview":"world-none-preview"})}),e("div",{className:u===2?"preview-title-part active":"preview-title-part",children:"\u30B7\u30C1\u30E5\u30A8\u30FC\u30B7\u30E7\u30F3"})]})]}),h("div",{className:"point-select",children:[e("div",{className:"point-search",children:h("form",{onSubmit:j,children:[e(ie,{value:b,onChange:(i,n)=>{typeof n=="string"?y({label:n}):n&&n.inputValue?y({label:n.inputValue}):y(n)},filterOptions:(i,n)=>ge(i,n),selectOnFocus:!0,clearOnBlur:!0,handleHomeEndKeys:!0,options:A,getOptionLabel:i=>typeof i=="string"?i:i.label,renderOption:(i,n)=>e("li",P(H({},i),{children:n.label})),renderInput:i=>e(ne,P(H({},i),{label:""}))}),e("button",{className:"search-btn",children:e("img",{src:"/assets/image/point-search.png",alt:""})})]})}),e("div",{className:"point-intro",children:"\u753B\u50CF\u306FBing\u306E\u691C\u7D22\u7D50\u679C\u3092\u3082\u3068\u306B\u8868\u793A\u3057\u3066\u3044\u307E\u3059"}),h("div",{className:"point-body",style:{height:`calc(${_}px - 420px)`},children:[u===1&&e("div",{className:"point-body-wrap",children:F.map((i,n)=>e("div",{style:{backgroundImage:`url(${i.img_url})`},onClick:()=>O(i.chara_id),className:`${c.map(l=>l.chara_id).includes(i.chara_id)?"active":""} character-item`,children:e("span",{})},n))}),u==2&&e("div",{className:"point-body-wrap",children:z.map((i,n)=>e("div",{style:{backgroundImage:`url(${i.img_url})`},className:`${(s==null?void 0:s.img_url)==i.img_url?"active":""} location-item`,onClick:l=>{E(i)},children:e("span",{})},n))})]})]})]}),e("div",{className:"character-add-btn-part",children:e("button",{onClick:J,className:`character-add-btn ${C?"active":""}`,disabled:!C,children:"\u30DE\u305C\u308B"})})]})}const X="https://mazete-api-dev.pechakucha.ai";function _e(){const[t,u]=r.exports.useState([0,0]);return r.exports.useLayoutEffect(()=>{function a(){u([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",a),a(),()=>window.removeEventListener("resize",a)},[]),t}function ve(){const t=q(),u=r.exports.useRef(),[a,c]=r.exports.useState(!1),[d,s]=r.exports.useState(!0),[E,C]=r.exports.useState(`\u30D3\u30EB\u306E\u5C4B\u4E0A\u306B\u3042\u3064\u3081\u3089\u308C\u305F\u30B4\u30F3\u9054\u3002

\u5229\u6839\u5DDD\u304B\u3089\u9244\u9AA8\u306E\u4E0A\u3092\u6E21\u3063\u3066\u3001\u5411\u3053\u3046\u306E\u30D3\u30EB\u3078\u884C\u3051\u305F\u3082\u306E\u306B\u8CDE\u91D1\u304C\u3082\u3089\u3048\u308B\u3068\u8AAC\u660E\u3092\u53D7\u3051\u308B\u3002

\u30B4\u30F3\u9054\u306F\u3044\u304B\u306B\u3057\u3066\u3053\u306E\u5371\u6A5F\u3092\u4E57\u308A\u8D8A\u3048\u308B\u306E\u304B\uFF1F`),[T,F]=r.exports.useState([]),[D,z]=r.exports.useState(null),[L,x]=_e();r.exports.useEffect(()=>{let g=window.innerHeight;document.getElementById("loading_synposis").style.height=g+"px";let m=localStorage.register_id||null,A=localStorage.outline_id||null,f=localStorage.background||null,b=localStorage.user_list||null;(!b||!f)&&t("/",{state:{}}),z(f),F(JSON.parse(b));let y=JSON.stringify({user_id:m,outline_id:A}),I={method:"post",url:`${X}/get_outline`,headers:{"Content-Type":"application/json"},data:y};v(I).then(_=>{_.data.generated&&_.data.outline&&!_.data.error?(s(!1),C(_.data.outline)):t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(_=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},[]);const B=()=>{let g=localStorage.register_id||null,m=localStorage.outline_id||null,A=JSON.stringify({user_id:g,outline_id:m,outline:E}),f={method:"post",url:`${X}/generate_story`,headers:{"Content-Type":"application/json"},data:A};v(f).then(b=>{window.location.assign(`/talk/${b.data.story_id}`)}).catch(b=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})};return r.exports.useEffect(()=>{u.current&&a&&u.current.focus()},[a]),h("div",{className:"container",id:"loading_synposis",children:[h("div",{className:"container-wrap",children:[e("div",{className:`ls-top ${a?"editing":""}`,children:e("div",{className:"",style:{backgroundImage:`url(${D}`,backgroundRepeat:"no-repeat",backgroundSize:"cover",backgroundPosition:"center"},children:e("div",{className:"ls-top-body",children:T.map((g,m)=>e("div",{className:"ls-top-item",style:{backgroundImage:`url(${g})`}},m))})})}),h("div",{className:"ls-main",style:{height:`calc(${x}px - 280px)`},children:[e("div",{className:"ls-main-title",children:"\u307E\u3048\u304C\u304D"}),h("div",{className:"ls-main-loading-text",style:{height:"calc(100% - 70px)"},children:[d&&h("div",{className:"ls-main-loading-part",children:[e("img",{src:"/assets/image/white-loading.gif",alt:""}),e("span",{children:"\u4E0B\u66F8\u304D\u6E96\u5099\u4E2D"})]}),!d&&e("textarea",{ref:u,className:"ls-main-loading-wrap",value:E,disabled:!a,onChange:g=>{C(g.target.value)},onBlur:()=>{c(!1)}})]}),!a&&h("a",{className:"ls-main-edit-btn",onClick:()=>{u.current.focus(),c(!0)},children:[e("span",{children:"\u7DE8\u96C6"}),e("img",{src:"/assets/image/edit-icon.png",alt:""})]})]})]}),!a&&e("button",{className:"back-to-btn",onClick:()=>{let g=localStorage.user_list||null;t("/",{state:{user_list:g}})},children:e("img",{src:"/assets/image/back-to-img.png",alt:""})}),!a&&e("div",{className:"ls-main-making-btn-part",children:e("button",{onClick:B,className:d?"ls-main-making-btn":"ls-main-making-btn active",disabled:d,children:"\u3053\u306E\u4E16\u754C\u7DDA\u306B\u5165\u308B"})})]})}const Ee="https://mazete-api-dev.pechakucha.ai";function Y(t){return new Promise(u=>setTimeout(u,t))}function be(){const[t,u]=r.exports.useState([0,0]);return r.exports.useLayoutEffect(()=>{function a(){u([window.innerWidth,window.innerHeight])}return window.addEventListener("resize",a),a(),()=>window.removeEventListener("resize",a)},[]),t}function ye(){const t=q(),[u,a]=r.exports.useState(!0),[c,d]=r.exports.useState(null),[s,E]=r.exports.useState(0),[C,T]=r.exports.useState(null),[F,D]=r.exports.useState(null),[z,L]=r.exports.useState([]),[x,B]=r.exports.useState(!1),[g,m]=r.exports.useState(!1),[A,f]=r.exports.useState(!1),[b,y]=be();let{story_id:I}=oe();const _=G.useRef(s),O=l=>{_.current=l,E(l)};r.exports.useEffect(()=>{let l=localStorage.register_id||null,o=JSON.stringify({user_id:l,story_id:I}),S={method:"post",url:`${Ee}/get_story`,headers:{"Content-Type":"application/json"},data:o};v(S).then(w=>{a(!1),w.data.generated&&!w.data.error?(a(!1),d(w.data)):t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})}).catch(w=>{t("/error",{state:{message:"\u30B9\u30C8\u30FC\u30EA\u30FC\u306E\u751F\u6210\u306B\u5931\u6557\u3057\u307E\u3057\u305F\u3002<br/>\u6642\u9593\u3092\u304A\u3044\u3066\u304A\u8A66\u3057\u304F\u3060\u3055\u3044"}})})},[]),r.exports.useEffect(()=>{c&&J()},[c,s]),r.exports.useEffect(async()=>{if(c){let l=c.story;await Y(1),T(l[s].position)}},[F]);const J=()=>{let l=c.story;D(l[s].chara_img_url),l[s].multiple?(B(!0),L(l[s].content)):(B(!1),j(l[s].content))},j=async l=>{f(!0);for(var o=0;o<l.length;)L([l.substring(0,o+1)]),o++,await Y(75);f(!1),c.story.length-1==s&&m(!0)},W=l=>{x&&(B(!1),j(l))},i=()=>{!A&&!x&&c.story.length-1>s&&O(s+1)},n=()=>{_.current===0&&t("/synopsis",{state:{}}),_.current!=0&&!A&&(O(0),m(!1))};return h(Q,{children:[u&&e("div",{className:"container",id:"loading_adventure",children:e("div",{className:"container-wrap",children:h("div",{className:"la-wrap",children:[e("img",{src:"/assets/image/black-loading.gif",alt:""}),e("span",{children:"\u6E96\u5099\u4E2D"})]})})}),!u&&h("div",{className:"container",id:"adventure_state",style:{height:y},children:[h("div",{className:"container-wrap",onClick:i,children:[e("div",{className:"as-thumb",style:{backgroundImage:`url(${c==null?void 0:c.background_url})`},children:F&&e("img",{src:F,alt:"",className:`as-thumb-character ${C==0?"lb":C==1?"mb":"rb"}`})}),e("div",{className:"as-text",children:z.map((l,o)=>e("div",{className:`as-text-wrap ${x?"":"arrow"}`,onClick:()=>{W(l)},children:l},o))})]}),e("button",{className:"back-to-btn",onClick:n,children:e("img",{src:s==0?"/assets/image/back-to-img.png":"/assets/image/back.png",alt:""})}),g&&h("div",{className:"text-select-btn-group",children:[e("a",{onClick:()=>{O(0),m(!1)},className:"final-btn",children:"\u30C8\u30C3\u30D7\u3078"}),e("a",{className:"final-btn",children:"\u30B7\u30A7\u30A2"})]})]})]})}function we(){const t=U();return console.log(t),e("div",{className:"flex-center position-ref full-height full-width bg-white",children:e("div",{className:"message",style:{padding:"10px"},dangerouslySetInnerHTML:{__html:t.state.message}})})}function Ce(){return e(ce,{children:h(de,{children:[e(R,{path:"/",element:e(fe,{})}),e(R,{path:"/synopsis",element:e(ve,{})}),e(R,{path:"/talk/:id",element:e(ye,{})}),e(R,{path:"/error",element:e(we,{})})]})})}function Fe(){return e(Q,{children:e(Ce,{})})}he.render(e(G.StrictMode,{children:e(Fe,{})}),document.getElementById("root"));
